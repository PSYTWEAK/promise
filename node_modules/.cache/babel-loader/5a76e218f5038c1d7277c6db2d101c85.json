{"ast":null,"code":"import _slicedToArray from \"/Users/nanoissuperior/prom/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/nanoissuperior/prom/client/src/App.js\";\nimport React, { Component, useState, useEffect } from \"react\";\nimport { BrowserRouter as Router, Switch, Route, Link } from \"react-router-dom\";\nimport PromController from \"./contracts/PromController.json\";\nimport token from \"./contracts/Token1.json\";\nimport getWeb3 from \"./getWeb3\";\nimport ConnectWallet from \"./components/ConnectWallet.js\";\nimport CreatePromise from \"./pages/CreatePromise.js\";\nimport FindPromise from \"./pages/FindPromise.js\";\nimport \"./App.css\";\nexport default function App() {\n  const _useState = useState(null),\n        _useState2 = _slicedToArray(_useState, 2),\n        web3 = _useState2[0],\n        setWeb3 = _useState2[1];\n\n  const _useState3 = useState(null),\n        _useState4 = _slicedToArray(_useState3, 2),\n        account = _useState4[0],\n        setAccount = _useState4[1];\n\n  const _useState5 = useState(null),\n        _useState6 = _slicedToArray(_useState5, 2),\n        prom = _useState6[0],\n        setProm = _useState6[1];\n\n  const _useState7 = useState(null),\n        _useState8 = _slicedToArray(_useState7, 2),\n        assetA = _useState8[0],\n        setAssetA = _useState8[1];\n\n  const _useState9 = useState(null),\n        _useState10 = _slicedToArray(_useState9, 2),\n        assetB = _useState10[0],\n        setAssetB = _useState10[1];\n\n  const _useState11 = useState(null),\n        _useState12 = _slicedToArray(_useState11, 2),\n        amountA = _useState12[0],\n        setAmountA = _useState12[1];\n\n  const _useState13 = useState(null),\n        _useState14 = _slicedToArray(_useState13, 2),\n        amountB = _useState14[0],\n        setAmountB = _useState14[1];\n\n  const _useState15 = useState(null),\n        _useState16 = _slicedToArray(_useState15, 2),\n        time = _useState16[0],\n        setTime = _useState16[1];\n\n  const _useState17 = useState(null),\n        _useState18 = _slicedToArray(_useState17, 2),\n        assetInstance = _useState18[0],\n        setAssetInstance = _useState18[1];\n\n  const _useState19 = useState(null),\n        _useState20 = _slicedToArray(_useState19, 2),\n        assetADeclimals = _useState20[0],\n        setAssetADeclimals = _useState20[1];\n\n  const _useState21 = useState(null),\n        _useState22 = _slicedToArray(_useState21, 2),\n        approved = _useState22[0],\n        setApproved = _useState22[1];\n\n  const _useState23 = useState(null),\n        _useState24 = _slicedToArray(_useState23, 2),\n        balanceAssetA = _useState24[0],\n        setBalanceAssetA = _useState24[1];\n\n  const _useState25 = useState(null),\n        _useState26 = _slicedToArray(_useState25, 2),\n        joinablePromises = _useState26[0],\n        setJoinablePromises = _useState26[1];\n\n  const _useState27 = useState(null),\n        _useState28 = _slicedToArray(_useState27, 2),\n        activePromises = _useState28[0],\n        setActivePromises = _useState28[1];\n\n  const _useState29 = useState(null),\n        _useState30 = _slicedToArray(_useState29, 2),\n        pairID = _useState30[0],\n        setPairID = _useState30[1];\n\n  const setUpWeb3 = async () => {\n    try {\n      const _web3 = await getWeb3();\n\n      const accounts = await _web3.eth.getAccounts();\n      const networkId = await _web3.eth.net.getId();\n      const deployedNetwork = PromController.networks[networkId];\n      setProm(new _web3.eth.Contract(PromController.abi, deployedNetwork && deployedNetwork.address));\n      setWeb3(_web3);\n      setAccount(accounts[0]);\n    } catch (error) {\n      // Catch any errors for any of the above operations.\n      alert(\"Failed to load web3, accounts, or contract. Check console for details.\");\n      console.error(error);\n    }\n  };\n\n  setUpWeb3();\n  useEffect(() => {\n    if (assetA) {\n      if (assetInstance) {\n        checkBalance();\n        checkAllowance();\n      } else if (web3.utils.isAddress(assetA)) {\n        createTokenInstance();\n      }\n    }\n  }, [assetA, amountA]);\n\n  async function getAccount() {\n    await window.ethereum.request({\n      method: \"eth_requestAccounts\"\n    }).then(result => {\n      setAccount(result[0]);\n    });\n  }\n\n  async function createTokenInstance() {\n    var _assetInstance = new web3.eth.Contract(token.abi, assetA);\n\n    var decimals = await _assetInstance.methods.decimals().call();\n    setAssetInstance(_assetInstance);\n    setAssetADeclimals(decimals);\n  }\n\n  async function checkBalance() {\n    var balanceOf = await assetInstance.methods.balanceOf(account).call();\n    setBalanceAssetA(balanceOf);\n  }\n\n  async function checkAllowance() {\n    var allo = await assetInstance.methods.allowance(account, prom._address).call();\n\n    if (allo >= amountA) {\n      setApproved(true);\n    } else {\n      setApproved(false);\n    }\n  }\n\n  async function approve(conAddr) {\n    await assetInstance.methods.approve(prom._address, (2 ** 256).toLocaleString(\"fullwide\", {\n      useGrouping: false\n    })).send({\n      from: account\n    }).then(result => {\n      console.log(result);\n      setApproved(true);\n    });\n  }\n\n  async function createPromise() {\n    // 2 test token addresses\n    //0x714293A0fEbC7fBC1225B3A2f63C71D091dC1183\n    //0xd72915144517e82e86926926d1308a44455eb6b0\n    await prom.methods.createPromise(amountA.toLocaleString(\"fullwide\", {\n      useGrouping: false\n    }), assetA, amountB.toLocaleString(\"fullwide\", {\n      useGrouping: false\n    }), assetB, time.toString()).send({\n      from: account\n    }).then(result => {\n      console.log(\"created promise \" + result.hash);\n      setAssetA(null);\n      setAssetB(null);\n      setAmountA(null);\n      setAmountB(null);\n      setTime(null);\n    });\n  }\n\n  async function getPairID() {\n    setPairID((await prom.methods.getJoinablePromises(assetA, assetB).call()));\n  }\n\n  async function getAllPromises() {\n    var promiseIds = await prom.methods.getJoinablePromises().call();\n    var _joinablePromises = [];\n    var activePromises = [];\n\n    for (var i = 0; i < promiseIds.length; i++) {\n      var a = promiseIds[i].toString();\n      var p = await prom.methods.getPromise(a).call();\n\n      _joinablePromises.push(p);\n    }\n\n    setJoinablePromises(_joinablePromises);\n    setActivePromises((await prom.methods.getActivePromises().call()));\n  }\n\n  return React.createElement(Router, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    class: \"App\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143\n    },\n    __self: this\n  }, React.createElement(\"h1\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144\n    },\n    __self: this\n  }, \"Promise \\uD83E\\uDD1D\"), React.createElement(ConnectWallet, {\n    getAccount: () => getAccount(),\n    account: account,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145\n    },\n    __self: this\n  }), React.createElement(Link, {\n    to: \"/Create\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146\n    },\n    __self: this\n  }, \"Create Promise\"), React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147\n    },\n    __self: this\n  }), React.createElement(Link, {\n    to: \"/Find\",\n    onClick: () => getAllPromises(),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148\n    },\n    __self: this\n  }, \"Find Promise\"), React.createElement(Switch, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151\n    },\n    __self: this\n  }, React.createElement(Route, {\n    path: \"/Create\",\n    exact: true,\n    render: props => React.createElement(CreatePromise, {\n      setAssetA: a => setAssetA(a),\n      setAssetB: a => setAssetB(a),\n      setAmountA: a => setAmountA(a),\n      setAmountB: a => setAmountB(a),\n      setTime: t => setTime(t),\n      createPromise: () => createPromise(),\n      approve: () => approve(),\n      approved: approved,\n      balanceAssetA: balanceAssetA,\n      assetADeclimals: assetADeclimals,\n      amountA: amountA,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156\n      },\n      __self: this\n    }),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152\n    },\n    __self: this\n  }), React.createElement(Route, {\n    path: \"/Find\",\n    exact: true,\n    render: props => React.createElement(FindPromise, {\n      joinablePromises: joinablePromises,\n      activePromises: activePromises,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174\n      },\n      __self: this\n    }),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171\n    },\n    __self: this\n  }))));\n}","map":{"version":3,"sources":["/Users/nanoissuperior/prom/client/src/App.js"],"names":["React","Component","useState","useEffect","BrowserRouter","Router","Switch","Route","Link","PromController","token","getWeb3","ConnectWallet","CreatePromise","FindPromise","App","web3","setWeb3","account","setAccount","prom","setProm","assetA","setAssetA","assetB","setAssetB","amountA","setAmountA","amountB","setAmountB","time","setTime","assetInstance","setAssetInstance","assetADeclimals","setAssetADeclimals","approved","setApproved","balanceAssetA","setBalanceAssetA","joinablePromises","setJoinablePromises","activePromises","setActivePromises","pairID","setPairID","setUpWeb3","_web3","accounts","eth","getAccounts","networkId","net","getId","deployedNetwork","networks","Contract","abi","address","error","alert","console","checkBalance","checkAllowance","utils","isAddress","createTokenInstance","getAccount","window","ethereum","request","method","then","result","_assetInstance","decimals","methods","call","balanceOf","allo","allowance","_address","approve","conAddr","toLocaleString","useGrouping","send","from","log","createPromise","toString","hash","getPairID","getJoinablePromises","getAllPromises","promiseIds","_joinablePromises","i","length","a","p","getPromise","push","getActivePromises","props","t"],"mappings":"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","sourcesContent":["import React, { Component, useState, useEffect } from \"react\";\nimport { BrowserRouter as Router, Switch, Route, Link } from \"react-router-dom\";\nimport PromController from \"./contracts/PromController.json\";\nimport token from \"./contracts/Token1.json\";\nimport getWeb3 from \"./getWeb3\";\n\nimport ConnectWallet from \"./components/ConnectWallet.js\";\nimport CreatePromise from \"./pages/CreatePromise.js\";\nimport FindPromise from \"./pages/FindPromise.js\";\n\nimport \"./App.css\";\n\nexport default function App() {\n  const [web3, setWeb3] = useState(null);\n  const [account, setAccount] = useState(null);\n  const [prom, setProm] = useState(null);\n  const [assetA, setAssetA] = useState(null);\n  const [assetB, setAssetB] = useState(null);\n  const [amountA, setAmountA] = useState(null);\n  const [amountB, setAmountB] = useState(null);\n  const [time, setTime] = useState(null);\n  const [assetInstance, setAssetInstance] = useState(null);\n  const [assetADeclimals, setAssetADeclimals] = useState(null);\n  const [approved, setApproved] = useState(null);\n  const [balanceAssetA, setBalanceAssetA] = useState(null);\n\n  const [joinablePromises, setJoinablePromises] = useState(null);\n  const [activePromises, setActivePromises] = useState(null);\n  const [pairID, setPairID] = useState(null);\n\n  const setUpWeb3 = async () => {\n    try {\n      const _web3 = await getWeb3();\n\n      const accounts = await _web3.eth.getAccounts();\n\n      const networkId = await _web3.eth.net.getId();\n      const deployedNetwork = PromController.networks[networkId];\n\n      setProm(new _web3.eth.Contract(PromController.abi, deployedNetwork && deployedNetwork.address));\n      setWeb3(_web3);\n      setAccount(accounts[0]);\n    } catch (error) {\n      // Catch any errors for any of the above operations.\n      alert(`Failed to load web3, accounts, or contract. Check console for details.`);\n      console.error(error);\n    }\n  };\n  setUpWeb3();\n  useEffect(() => {\n    if (assetA) {\n      if (assetInstance) {\n        checkBalance();\n        checkAllowance();\n      } else if (web3.utils.isAddress(assetA)) {\n        createTokenInstance();\n      }\n    }\n  }, [assetA, amountA]);\n\n  async function getAccount() {\n    await window.ethereum\n      .request({\n        method: \"eth_requestAccounts\",\n      })\n      .then((result) => {\n        setAccount(result[0]);\n      });\n  }\n  async function createTokenInstance() {\n    var _assetInstance = new web3.eth.Contract(token.abi, assetA);\n    var decimals = await _assetInstance.methods.decimals().call();\n    setAssetInstance(_assetInstance);\n    setAssetADeclimals(decimals);\n  }\n\n  async function checkBalance() {\n    var balanceOf = await assetInstance.methods.balanceOf(account).call();\n    setBalanceAssetA(balanceOf);\n  }\n\n  async function checkAllowance() {\n    var allo = await assetInstance.methods.allowance(account, prom._address).call();\n    if (allo >= amountA) {\n      setApproved(true);\n    } else {\n      setApproved(false);\n    }\n  }\n\n  async function approve(conAddr) {\n    await assetInstance.methods\n      .approve(prom._address, (2 ** 256).toLocaleString(\"fullwide\", { useGrouping: false }))\n      .send({ from: account })\n      .then((result) => {\n        console.log(result);\n        setApproved(true);\n      });\n  }\n\n  async function createPromise() {\n    // 2 test token addresses\n    //0x714293A0fEbC7fBC1225B3A2f63C71D091dC1183\n    //0xd72915144517e82e86926926d1308a44455eb6b0\n    await prom.methods\n      .createPromise(\n        amountA.toLocaleString(\"fullwide\", { useGrouping: false }),\n        assetA,\n        amountB.toLocaleString(\"fullwide\", { useGrouping: false }),\n        assetB,\n        time.toString()\n      )\n      .send({ from: account })\n      .then((result) => {\n        console.log(\"created promise \" + result.hash);\n        setAssetA(null);\n        setAssetB(null);\n        setAmountA(null);\n        setAmountB(null);\n        setTime(null);\n      });\n  }\n\n  async function getPairID() {\n    setPairID(await prom.methods.getJoinablePromises(assetA, assetB).call());\n  }\n  async function getAllPromises() {\n    var promiseIds = await prom.methods.getJoinablePromises().call();\n    var _joinablePromises = [];\n    var activePromises = [];\n    for (var i = 0; i < promiseIds.length; i++) {\n      var a = promiseIds[i].toString();\n      var p = await prom.methods.getPromise(a).call();\n      _joinablePromises.push(p);\n    }\n\n    setJoinablePromises(_joinablePromises);\n    setActivePromises(await prom.methods.getActivePromises().call());\n  }\n\n  return (\n    <Router>\n      <div class=\"App\">\n        <h1>Promise 🤝</h1>\n        <ConnectWallet getAccount={() => getAccount()} account={account} />\n        <Link to=\"/Create\">Create Promise</Link>\n        <br />\n        <Link to=\"/Find\" onClick={() => getAllPromises()}>\n          Find Promise\n        </Link>\n        <Switch>\n          <Route\n            path=\"/Create\"\n            exact\n            render={(props) => (\n              <CreatePromise\n                setAssetA={(a) => setAssetA(a)}\n                setAssetB={(a) => setAssetB(a)}\n                setAmountA={(a) => setAmountA(a)}\n                setAmountB={(a) => setAmountB(a)}\n                setTime={(t) => setTime(t)}\n                createPromise={() => createPromise()}\n                approve={() => approve()}\n                approved={approved}\n                balanceAssetA={balanceAssetA}\n                assetADeclimals={assetADeclimals}\n                amountA={amountA}\n              />\n            )}\n          />\n          <Route\n            path=\"/Find\"\n            exact\n            render={(props) => <FindPromise joinablePromises={joinablePromises} activePromises={activePromises} />}\n          />\n        </Switch>\n      </div>\n    </Router>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}